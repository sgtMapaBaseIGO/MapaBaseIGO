<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <link rel="shortcut icon" href="../../img/favicon.ico">

    
    <title>Extracción de objetos OSM - Mapa Base IGO</title>
    

    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/3.003/css/hack.min.css">
    <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="../../css/base.min.css" rel="stylesheet">
    <link href="../../css/cinder.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.min.css">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
        <![endif]-->

    <script src="//ajax.googleapis.com/ajax/libs/webfont/1.6.28/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    

     
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->

            <a class="navbar-brand" href="../..">Mapa Base IGO</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Proyecto <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../proyecto/justificacion/">Justificación</a>
</li>

                        
                            
<li >
    <a href="../../proyecto/objetivo/">Objetivo</a>
</li>

                        
                            
<li >
    <a href="../../proyecto/directrices/">Directrices</a>
</li>

                        
                            
<li >
    <a href="../../proyecto/acciones/">Acciones</a>
</li>

                        
                            
<li >
    <a href="../../proyecto/handicaps/">Hándicaps</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Diseño <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Esquemas teselas vectoriales</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../diseno/esquemas_vt/esquema_vt_igo/">Información Geográfica Oficial (IGO)</a>
</li>

        
            
<li >
    <a href="../../diseno/esquemas_vt/esquema_vt_ext/">Fuentes de datos no oficiales</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Simbolización</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../diseno/simbolizacion/mapa_general/">Mapa General (en construcción)</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Recursos <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Medio físico</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../recursos/medio_fisico/batimetria/">Batimetría</a>
</li>

        
            
<li >
    <a href="../../recursos/medio_fisico/bioma/">Bioma</a>
</li>

        
            
<li >
    <a href="../../recursos/medio_fisico/tierra_firme/">Tierra firme (en edición)</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Cubierta terrestre</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../recursos/cubierta_terrestre/nodisponible/">(No disponible)</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Población/Edificaciones/Parcelas</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../recursos/poblacion_edificaciones_parcelas/nodisponible/">(No disponible)</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Comunicaciones/Infraestructuras</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../recursos/comunicaciones_infraestructuras/nodisponible/">(No disponible)</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Servicios/Instalaciones</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../recursos/servicios_instalaciones/nodisponible/">(No disponible)</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Sociedad/Cultura</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../recursos/sociedad_cultura/nodisponible/">(No disponible)</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Límites político-administrativos</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../recursos/limites_politicoadministrativos/nodisponible/">(No disponible)</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Gestión del territorio</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../recursos/gestion_del_territorio/nodisponible/">(No disponible)</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Callejero/Pks</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../recursos/callejero_pks/nodisponible/">(No disponible)</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Nombres geográficos/Toponimia</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../recursos/nombres_geograficos_toponimia/nodisponible/">(No disponible)</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Referencias geográficas</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../recursos/referencias_geograficas/nodisponible/">(No disponible)</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Implementación <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Elementos IGO</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../elementos_igo/callejero/">Callejero</a>
</li>

        
            
<li >
    <a href="../elementos_igo/hidrografia/">Hidrografía</a>
</li>

        
            
<li >
    <a href="../elementos_igo/lineas_limite/">Líneas límite</a>
</li>

        
            
<li >
    <a href="../elementos_igo/nomenclator/">Nomenclátor</a>
</li>

        
            
<li >
    <a href="../elementos_igo/suelo/">Suelo</a>
</li>

        
            
<li >
    <a href="../elementos_igo/tematico/">Temático</a>
</li>

        
            
<li >
    <a href="../elementos_igo/transporte/">Transporte</a>
</li>

        
    </ul>
  </li>

                        
                            
<li >
    <a href="../descarga_bd_osm/">Descarga BD OSM</a>
</li>

                        
                            
<li class="active">
    <a href="./">Extracción de objetos OSM</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Elementos OSM</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../elementos_osm/admin_level/">admin_level</a>
</li>

        
            
<li >
    <a href="../elementos_osm/aeroway/">aeroway</a>
</li>

        
            
<li >
    <a href="../elementos_osm/boundary/">boundary</a>
</li>

        
            
<li >
    <a href="../elementos_osm/building/">building</a>
</li>

        
            
<li >
    <a href="../elementos_osm/highway/">highway</a>
</li>

        
            
<li >
    <a href="../elementos_osm/landuse/">landuse</a>
</li>

        
            
<li >
    <a href="../elementos_osm/leisure/">leisure</a>
</li>

        
            
<li >
    <a href="../elementos_osm/natural/">natural</a>
</li>

        
            
<li >
    <a href="../elementos_osm/place/">place</a>
</li>

        
            
<li >
    <a href="../elementos_osm/railway/">railway</a>
</li>

        
            
<li >
    <a href="../elementos_osm/water/">water</a>
</li>

        
            
<li >
    <a href="../elementos_osm/waterway/">waterway</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Referencias <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../referencias/mapas_teselados/">Mapas teselados</a>
</li>

                        
                            
<li >
    <a href="../../referencias/servicios_de_teselas_vectoriales/">Servicios de teselas vectoriales</a>
</li>

                        
                            
<li >
    <a href="../../referencias/teselas_vectoriales_carto/">Teselas vectoriales CARTO</a>
</li>

                        
                            
<li >
    <a href="../../referencias/teselas_vectoriales_icgc/">Teselas vectoriales ICGC</a>
</li>

                        
                            
<li >
    <a href="../../referencias/teselas_vectoriales_os/">Teselas vectoriales OS</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Información <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../informacion/licencia/">Licencia</a>
</li>

                        
                            
<li >
    <a href="../../informacion/mapabase_igo/">MapaBaseIGO</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>

            <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                            <i class="fas fa-search"></i> Search
                        </a>
                    </li>
                    <li >
                        <a rel="next" href="../descarga_bd_osm/">
                            <i class="fas fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../elementos_osm/admin_level/">
                            Next <i class="fas fa-arrow-right"></i>
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="first-level active"><a href="#extraccion-de-objetos-openstreetmap">Extracción de objetos OpenStreetMap</a></li>
            <li class="second-level"><a href="#extraccion-de-elementos">Extracción de elementos</a></li>
                
                <li class="third-level"><a href="#nodos-geometrias-de-puntos">Nodos (geometrías de puntos)</a></li>
                <li class="third-level"><a href="#ways-geometrias-de-lineas">Ways (geometrías de líneas)</a></li>
            <li class="second-level"><a href="#conversion-a-pbf">Conversión a PBF</a></li>
                
            <li class="second-level"><a href="#conversion-a-geojson">Conversión a GeoJSON</a></li>
                
                <li class="third-level"><a href="#nodos-ways-y-relations">Nodos, ways y relations</a></li>
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="extraccion-de-objetos-openstreetmap">Extracción de objetos OpenStreetMap</h1>
<p><br /></p>
<p>Repasamos aquí los distintos procesos seguidos para la extracción de los elementos de la Base de Datos OSM, hasta su conversión a archivos GeoJSON preparados para su procesamiento.</p>
<p><br /></p>
<h3 id="extraccion-de-elementos">Extracción de elementos</h3>
<p><br /></p>
<h4 id="nodos-geometrias-de-puntos">Nodos (geometrías de puntos)</h4>
<p><br />
El comando <code>osm3s_query</code> extrae elementos en formato <em>'osm'</em> o <em>'json-osm'</em>. No extrae directamente en formato <em>'GeoJSON'</em>.</p>
<p>La <a href="https://wiki.openstreetmap.org/wiki/Overpass_API/Language_Guide">sintaxis de las consultas</a> sigue el estándar de <em>Overpass</em></p>
<p>Para este proyecto la extracción se realiza en formato <em>'json-osm'</em> (se especifica como xml), ya que de esta manera es posible tratarlo con otras herramientas como <em>GDAL</em></p>
<p>Preparación de la consulta</p>
<p>Se crea un fichero de texto p.ej. <em>'place_town_node.query'</em> con la consulta a ejecutar:</p>
<pre><code>[out:xml][timeout:259200][maxsize:70000000000];
(
  node
    [&quot;place&quot;=&quot;town&quot;];
);
out;
</code></pre>

<p>Ejecutando a continuación el siguiente comando para la creación del fichero OSM que contendrá los elementos filtrados:</p>
<pre><code>/usr/local/osm3s/bin/osm3s_query --db-dir=/home/vagrant/geodata/db &lt; place_town_node.query &gt; place_town_node.osm
</code></pre>

<p><br /></p>
<h4 id="ways-geometrias-de-lineas">Ways (geometrías de líneas)</h4>
<p><br />
Igual que en el caso de los puntos, utilizaremos para la extracción el comando <code>osm3s_query</code>.</p>
<p>Preparación de la consulta</p>
<p>Se crea un fichero de texto p.ej. <em>'highway_raceway_way.query'</em> con el texto de la consulta a ejecutar:</p>
<pre><code>[out:xml][timeout:259200][maxsize:70000000000];
(
  way
    [&quot;highway&quot;=&quot;raceway&quot;];
);
out body;
&gt;;
out skel qt;
</code></pre>

<p>Ejecutando a continuación el siguiente comando para la creación del fichero OSM que contendrá los elementos filtrados:</p>
<pre><code>/usr/local/osm3s/bin/osm3s_query --db-dir=/home/vagrant/geodata/db &lt; highway_raceway_way.query &gt; highway_raceway_way.osm
</code></pre>

<p><br /></p>
<h3 id="conversion-a-pbf">Conversión a PBF</h3>
<p><br /></p>
<p>Antes de procesar un fichero <em>GeoJSON</em> con la herramienta <em>'GDAL'</em>, es necesario reordenar sus geometrías.</p>
<p>Para ello se utiliza la herramienta <em>'OSMIUM sort'</em>, que en la misma operación permite convertir el fichero <em>.osm</em> a formato <em>.pbf</em> con el fin de optimizar su tamaño:</p>
<pre><code>osmium sort --overwrite -o sorted.pbf input.osm
</code></pre>

<p><br /></p>
<h3 id="conversion-a-geojson">Conversión a GeoJSON</h3>
<p><br /></p>
<h4 id="nodos-ways-y-relations">Nodos, ways y relations</h4>
<p><br />
Para la generación de un fichero GeoJSON que contenga los objetos de OSM se utiliza la herramienta <em>GDAL:OGR2OGR</em>, que permite convertir el fichero <em>.pbf</em> a <em>.geojson</em>.</p>
<p>El comando a ejecutar para un caso de <em>nodos</em> es:</p>
<pre><code>ogr2ogr -f GeoJSON place_town.geojson place_town.pbf points
</code></pre>

<p>El resultado generará un fichero con todos los atributos de OSM que encuentre.</p>
<p>Para limitar los campos que se desean obtener o generar polígonos en base a líneas cerradas se utiliza el fichero de GDAL:
<code>/usr/local/share/gdal/osmconf.ini</code>. Este fichero se replica y configura para cada una de las capas, indicando los campos que se desean retener.</p>
<p>El comando a ejecutar es:</p>
<pre><code>ogr2ogr -f GeoJSON place_town.geojson place_town.pbf -oo CONFIG_FILE=./place_town_osmconf.ini points
</code></pre>

<p>En este ejemplo la parte del fichero <em>.ini</em> que configura los <em>'points'</em> es:</p>
<pre><code>[points]
# common attributes
osm_id=no
osm_version=no
osm_timestamp=no
osm_uid=no
osm_user=no
osm_changeset=no

# keys to report as OGR fields
attributes=name,name:es,place,population
# keys that, alone, are not significant enough to report a node as a OGR point
unsignificant=created_by,converted_by,source,time,ele,attribution
# keys that should NOT be reported in the &quot;other_tags&quot; field
ignore=created_by,converted_by,source,time,ele,note,openGeoDB:,fixme,FIXME
# uncomment to avoid creation of &quot;other_tags&quot; field
other_tags=no
# uncomment to create &quot;all_tags&quot; field. &quot;all_tags&quot; and &quot;other_tags&quot; are exclusive
all_tags=no
</code></pre>

<p>Cada capa tendrá su propia configuración y los campos especificados.</p>
<p>Es posible que aparezcan errores del tipo: <em>"ERROR 1: Failed inserting way 22101270: PRIMARY KEY must be unique"</em>.</p>
<p>Este tipo de errores se producen al intentar insertar un way que ya existe. En este caso el mensaje se puede ignorar ya que con una sola inserción es suficiente (no se pueden eliminar los <em>ways</em> duplicados desde la extracción de OSM).</p>
<p><br /></p>
<hr />
<p><em>13 mayo 2019</em></p></div>
        
        
    </div>

    <footer class="col-md-12 text-center">
        
        <hr>
        <p>
        <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p></small>
        
        
        
    </footer>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="../../js/bootstrap-3.0.3.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
    var base_url = '../..';
    </script>
    <!-- <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script> -->
    <script src="../../js/base.js"></script>
    <script src="../../search/main.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    </body>

</html>
